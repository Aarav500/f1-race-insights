{
    "DocumentName": "AWS-RunShellScript",
    "InstanceIds": [
        "i-00245e14610ccfa77"
    ],
    "Comment": "F1 App - Direct Code Deploy (No Docker Build)",
    "Parameters": {
        "commands": [
            "set -euo pipefail",
            "echo '=== Updating code ==='",
            "cd /opt/f1-race-insights",
            "git fetch origin main",
            "git reset --hard origin/main",
            "git log -1 --oneline",
            "echo ''",
            "echo '=== Restarting services with updated code ==='",
            "cd /opt/f1-race-insights",
            "docker compose down",
            "docker compose up -d --build",
            "echo ''",
            "echo '=== Waiting for services ==='",
            "sleep 15",
            "echo ''",
            "echo '=== Testing new endpoint ==='",
            "curl -s http://localhost:8000/meta/seasons || echo 'Failed'",
            "echo ''",
            "echo '=== Deployment complete ==='",
            "docker compose ps"
        ]
    }
}